\documentclass[12pt,a4paper]{report}

\usepackage[margin=1in]{geometry}
\usepackage{lipsum}
\usepackage{times}
\usepackage{listings}
%\usepackage{hyperref}

\makeatletter
\renewcommand{\@makechapterhead}[1]{%
  {\noindent\raggedright\normalfont% Alignment and font reset
   \huge\bfseries \@chapapp\space\thechapter~~#1\par\nobreak}% Formatting
  \vspace{\baselineskip}% ...just a little space
}
\makeatother


\usepackage[colorlinks = true,
            linkcolor = blue,
            urlcolor  = blue,
            citecolor = blue,
            anchorcolor = blue]{hyperref}

\newcommand{\changeurlcolor}[1]{\hypersetup{urlcolor=#1}}  


\setcounter{secnumdepth}{3}
\setcounter{tocdepth}{3}
\renewcommand{\contentsname}{Table of Contents}

\usepackage{titletoc}

\newcommand{\setupname}[1][\chaptername]{
\titlecontents{chapter}[0pt]{\vspace{1ex}}{\bfseries#1~\thecontentslabel:\quad}{\bfseries}{\bfseries\hfill\contentspage}[]
}

\author{Anthony McGlone}\title{Compile and boot a Linux Kernel}
\begin{document}\maketitle

\tableofcontents

\setupname
\chapter{Introduction}

This guide will demonstrate the basic process of compiling and booting a Linux kernel. More advanced kernel configuration (such as enabling device drivers or new kernel modules) will not be covered. 
\newline
\newline
If you're already using a Linux operating system (such as Ubuntu, Red Hat or CentOS), you can skip ahead to the kernel installation instructions for your OS. 
\newline
\newline
If you're on Windows or Mac, you can use Oracle's VirtualBox to test an installation.

\section{Installing Oracle VirtualBox}

1. Read the \href{https://www.virtualbox.org/manual/ch02.html}{installation instructions} for your OS.
\newline
2. Download the VirtualBox \href{https://www.virtualbox.org/wiki/Downloads}{binary / package} for your OS.
\newline
3. Download an ISO of a Linux OS (e.g. \href{https://ubuntu.com/download/desktop}{Ubuntu}, \href{https://www.centos.org/download/}{CentOS}, \href{https://getfedora.org/workstation/download/}{Fedora}).
\newline
4. \href{https://docs.oracle.com/cd/E26217_01/E26796/html/qs-create-vm.html}{Create a virtual machine} using the ISO / installation media.



\chapter{Ubuntu}

\section{Prerequisites}
In your Linux OS or VM, open a terminal. Install the GCC compiler and the other tools required to compile the kernel:
\newline
\newline
\centerline{\texttt{\scriptsize sudo apt-get install build-essential libncurses-dev bison flex libssl-dev libelf-dev}}

\section{Download the latest Linux kernel}
Open the kernel home page by navigating to \href{https://www.kernel.org/}{this website}. Download the latest source code by clicking on the large yellow button.
\newline
\newline
A \texttt{tar.xz} file should be downloaded to the \texttt{Downloads} folder (e.g. \texttt{\small linux-6.0.2.tar.xz}). 

\section{Extract the source code}
Navigate to your \texttt{Downloads} folder. In the \texttt{unxz} command, replace \texttt{<tar.xz file>} with the downloaded file. Run the command to extract the \texttt{tar} file:
\newline
\newline
\centerline{\texttt{unxz -v <tar.xz file>}}
\newline
\newline 
The PGP signature for the \texttt{tar} file should be verified before its contents are extracted. On the kernel home page, find the table row corresponding to the latest kernel version and copy the link address from the \texttt{[pgp]} link. In the \texttt{wget} command, replace \texttt{<pgp link address>} with this link. Then run the command to download the \texttt{tar.sign} file:
\newline
\newline
\centerline{\texttt{wget <pgp link address>}}
\newline
\newline 
In the \texttt{gpg} command, replace \texttt{<tar sign file>} with the downloaded \texttt{tar.sign} file. Then run it:
\newline
\newline
\centerline{\texttt{gpg --verify <tar sign file>}}
\newline
\newline 
The output from the command contains the RSA key, which will be used in the verification of the \texttt{tar.sign} file's signature:
\newline
\newline
\texttt{
gpg: assuming signed data in 'linux-6.0.2.tar'
\\
gpg: Signature made Sat 15 Oct 2022 07:04:02 IST
\\
gpg:                using RSA key \textbf{647F28654894E3BD457199BE38DBBDC86092693E}
\\
gpg: Can't check signature: No public key
}
\newline
\newline
Replace \texttt{<RSA key>} in the following command with the \texttt{RSA key} from \textbf{your} terminal output. Then run the command (it will download a public key that will be used in the verification):
\newline
\newline
\centerline{\texttt{\small gpg --recv-keys --keyserver hkps://keyserver.ubuntu.com <RSA key>}}
\newline
\newline 
Re-run the \texttt{--verify} command to complete the signature verification:
\newline
\newline
\centerline{\texttt{gpg --verify <tar sign file>}}
\newline
\newline
If successful, the output should look like this:
\newline
\newline
\texttt{\footnotesize
gpg: assuming signed data in 'linux-6.0.2.tar'
\\
gpg: Signature made Sat 15 Oct 2022 07:04:02 IST
\\
gpg:                using RSA key 647F28654894E3BD457199BE38DBBDC86092693E
\\
gpg: Good signature from "Greg Kroah-Hartman <gregkh@linuxfoundation.org>"
\\
gpg:                 aka "Greg Kroah-Hartman <gregkh@kernel.org>" [unknown]
\\
gpg:                 aka "Greg Kroah-Hartman (Linux kernel stable release signing key)
\\
gpg: WARNING: This key is not certified with a trusted signature!
\\
gpg:          There is no indication that the signature belongs to the owner.
\\
Primary key fingerprint: 647F 2865 4894 E3BD 4571  99BE 38DB BDC8 6092 693E
}
\newline
\newline
Extract the Linux kernel code using the \texttt{tar} command:
\newline
\newline
\centerline{\texttt{tar xvf <the tar file>}}
\newline
\newline
There should now be a folder with the extracted source code (e.g. \texttt{linux-6.0.2/}) 

\section{Configuring the kernel}
\texttt{cd} into the extracted folder. Before compiling the kernel, we must choose the modules that we wish to include. This can be done in two steps. First, copy the modules from the existing kernel configuration to the new configuration file:
\newline
\newline
\centerline{\texttt{cp -v /boot/config-\$(uname -r) .config}}
\newline
\newline
The next step is to run \texttt{make menuconfig}. This will load a graphical dialog (see below). With this dialog, you can add or remove modules from the config.


\end{document}



















